<?php

namespace App\Http\Controllers\Home;

use App\Algorithms\KMeansExtended;
use App\Http\Controllers\Controller;
use App\Models\Contact;
use App\Services\Geolocator;
use Illuminate\Support\Facades\Cache;

/**
 * Class HomeController
 * @package App\Http\Controllers\Home
 */
class HomeController extends Controller
{
    /**
     * @var Geolocator
     */
    protected $geolocator;

    /**
     * @var KMeansExtended
     */
    protected $kMeans;

    public function __construct(Geolocator $geolocator, KMeansExtended $kMeans)
    {
        $this->kMeans = $kMeans;
        $this->geolocator = $geolocator;
    }

    public function __invoke()
    {
        $rawData = [
            ['Michael',85273],
            ['James',85750],
            ['Brian',85751],
            ['Nicholas',85383],
            ['Jennifer',85716],
            ['Christopher',85014],
            ['Michael',85751],
            ['Patricia',95032],
            ['Beth',94556],
            ['Cathy',92260],
            ['Harold',92120],
            ['Robin',94062],
            ['James',90503],
            ['Douglas',32159],
            ['Donald',32404],
            ['Ilene',33140],
            ['William',33417],
            ['Lynn',32789],
            ['Leonie',33417],
            ['Katherine',32034],
            ['Melissa',30516],
            ['Kimberly',30345],
            ['Richard',30606],
            ['Richard',30312],
            ['Ayn',31901],
            ['Bruce',31410],
            ['Fred',89451],
            ['Robert',89110],
            ['David',89042],
            ['Maureen',89074],
            ['Mary Sue',89705],
            ['Janet',89144],
            ['John',89145],
            ['Rand',12580],
            ['Kathy',10604],
            ['Susan',13601],
            ['Robin',10021],
            ['Peter',12550],
            ['Diana',10603],
            ['Richard',12018],
        ];
        $contacts = [];
        foreach ($rawData as $contact) {
            $contacts[] = new Contact($contact[0], $contact[1]);
        }
        $coordinates = [];
        foreach ($contacts as $contact) {
            $contact->setCoordinates($this->geolocator->getCoordinatesByZipCode($contact->getZip()));
            $coordinates[] = $contact->getCoordinates();
        }
        var_dump($coordinates);
        $points = [
            [229	,	231],
            [655	,	136],
            [10	,	279],
            [472	,	418],
            [444	,	450],
            [263	,	372],
            [416	,	241],
            [477	,	374],
            [504	,	652],
            [564	,	327],
            [50	,	366],
            [95	,	157],
            [357	,	337],
            [325	,	575],
            [530	,	172],
            [50	,	457],
            [106	,	97],
            [46	,	129],
            [162	,	227],
            [668	,	117],
            [53	,	168],
            [572	,	128],
            [410	,	143],
            [10	,	251],
            [665	,	672],
            [700	,	414],
            [586	,	645],
            [679	,	13],
            [594	,	1],
            [421	,	256],
            [628	,	109],
            [221	,	250],
            [204	,	248],
            [316	,	55],
            [575	,	461],
            [132	,	474],
            [574	,	444],
            [102	,	96],
            [385	,	75],
            [242	,	686],
            [480	,	274],
            [552	,	304],
            [219	,	537],
            [636	,	231],
            [540	,	544],
            [563	,	299],
            [66	,	440],
            [69	,	612],
            [339	,	133],
            [148	,	44],
            [306	,	569],
            [11	,	497],
            [258	,	609],
            [34	,	395],
            [435	,	572],
            [491	,	171],
            [636	,	13],
            [363	,	285],
            [412	,	43],
            [4	,	530],
            [115	,	463],
            [519	,	11],
            [244	,	114],
            [283	,	656],
            [285	,	466],
            [289	,	572],
            [365	,	138],
            [440	,	685],
            [592	,	547],
            [535	,	510],
            [60	,	149],
            [69	,	140],
            [56	,	350],
            [149	,	203],
            [220	,	507],
            [52	,	178],
            [197	,	597],
            [148	,	432],
            [238	,	314],
            [312	,	11],
            [419	,	271],
            [259	,	87],
            [233	,	319],
            [666	,	416],
            [341	,	341],
            [368	,	58],
            [585	,	229],
            [289	,	410],
            [524	,	198],
            [13	,	448],
            [573	,	512],
            [518	,	341],
            [386	,	242],
            [280	,	594],
            [157	,	172],
            [298	,	543],
            [485	,	650],
            [157	,	279],
            [502	,	91],
            [461	,	571],
            [209	,	238],
            [112	,	695],
            [531	,	603],
            [235	,	682],
            [691	,	394],
            [606	,	357],
            [17	,	571],
            [638	,	139],
            [41	,	637],
            [436	,	451],
            [155	,	566],
            [153	,	580],
            [582	,	392],
            [418	,	623],
            [561	,	547],
            [204	,	245],
            [228	,	113],
            [88	,	293],
            [335	,	246],
            [516	,	351],
            [678	,	471],
            [84	,	437],
            [434	,	57],
            [407	,	666],
            [479	,	689],
            [137	,	85],
            [245	,	675],
            [243	,	347],
            [216	,	441],
            [602	,	270],
            [176	,	309],
            [507	,	276],
            [588	,	362],
            [115	,	46],
            [350	,	495],
            [482	,	600],
            [570	,	62],
            [551	,	154],
            [140	,	300],
            [85	,	209],
            [682	,	78],
            [129	,	309],
            [274	,	346],
            [329	,	602],
            [470	,	155],
            [197	,	607],
            [148	,	314],
            [319	,	440],
            [240	,	500],
            [319	,	428],
            [657	,	576],
            [436	,	630],
            [147	,	444],
            [460	,	157],
            [617	,	509],
            [218	,	53],
            [273	,	318],
            [104	,	490],
            [54	,	319],
            [490	,	606],
            [36	,	574],
            [122	,	247],
            [285	,	162],
            [696	,	91],
            [204	,	693],
            [189	,	532],
            [654	,	357],
            [101	,	80],
            [141	,	313],
            [253	,	155],
            [321	,	630],
            [219	,	326],
            [585	,	427],
            [325	,	84],
            [535	,	585],
            [2	,	102],
            [426	,	0],
            [267	,	655],
            [29	,	286],
            [92	,	313],
            [420	,	575],
            [483	,	681],
            [410	,	94],
            [221	,	539],
            [61	,	470],
            [411	,	298],
            [623	,	611],
            [123	,	271],
            [256	,	260],
            [325	,	669],
            [535	,	371],
            [71	,	321],
            [628	,	89],
            [671	,	187],
            [491	,	584],
            [484	,	597],
            [693	,	551],
            [165	,	410],
            [16	,	333],
            [229	,	5],
            [138	,	261],
            [333	,	612],
            [152	,	44],
            [300	,	584],
            [155	,	348],
            [30	,	74],
            [222	,	23],
            [577	,	205],
            [462	,	578],
            [231	,	325],
            [659	,	675],
            [527	,	565],
            [687	,	299],
            [476	,	626],
            [246	,	624],
            [345	,	338],
            [496	,	545],
            [373	,	607],
            [83	,	309],
            [299	,	196],
            [319	,	357],
            [603	,	384],
            [35	,	447],
            [150	,	286],
            [171	,	233],
            [12	,	445]
        ];
        $centers = [
            [10, 10.5],
            [50, 250],
        ];
        $space = new \App\Algorithms\KMeansExtended(2);
        foreach ($points as $point) {
            $space->addPoint($point);
        }
        $clusters = $space->solve($centers);

        return view('welcome', ['points' => $points, 'clusteredData' => $clusters]);

    }
}